<!DOCTYPE html>
<html>
  <head>
    <title>N-Body Simulation</title>
    <script src="https://cdn.plot.ly/plotly-2.16.1.min.js"></script>
  </head>
  <body style="background-color: black; color: white; text-align: center">
    <h1>N-Body Simulation</h1>
    <form id="simulation-form">
      <label for="N">Number of Particles:</label>
      <input type="number" id="N" name="N" value="1000" required />
      <br />
      <label for="dt">Time Step (dt):</label>
      <input type="text" id="dt" name="dt" value="0.0001" required />
      <br />
      <label for="t_max">Max Time (t_max):</label>
      <input type="text" id="t_max" name="t_max" value="0.01" required />
      <br />
      <button type="button" onclick="runSimulation()">Run Simulation</button>
    </form>

    <div id="simulation" style="width: 80%; margin: auto"></div>

    <script>
      async function runSimulation() {
        // Get input values
        const N = document.getElementById("N").value;
        const dt = document.getElementById("dt").value;
        const t_max = document.getElementById("t_max").value;

        // Send a POST request to the Flask backend
        const response = await fetch("/simulate", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            N: parseInt(N),
            dt: parseFloat(dt),
            t_max: parseFloat(t_max),
          }),
        });
        const frames = await response.json();

        // Plotly animation
        const trace = {
          x: frames[0].map((p) => p[0]),
          y: frames[0].map((p) => p[1]),
          mode: "markers",
          marker: { color: "white", size: 3 },
        };

        const layout = {
          title: "N-Body Simulation",
          xaxis: { range: [0, 1], title: "X" },
          yaxis: { range: [0, 1], title: "Y" },
          plot_bgcolor: "black",
          paper_bgcolor: "black",
          font: { color: "white" },
        };

        // Prepare frames for animation
        const plotlyFrames = frames.map((frame) => ({
          data: [
            {
              x: frame.map((p) => p[0]),
              y: frame.map((p) => p[1]),
            },
          ],
        }));

        Plotly.newPlot("simulation", [trace], layout);

        // Animate the frames
        Plotly.animate("simulation", {
          data: [trace],
          traces: [0],
          layout: layout,
          frames: plotlyFrames,
        });
      }
    </script>
  </body>
</html>
